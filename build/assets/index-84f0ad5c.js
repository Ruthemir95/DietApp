import{r as e,j as t,c as a,R as n}from"./vendor-react-2952a862.js";import{C as s,a as l,D as i,b as o,c as r,N as c,T as d}from"./components-fe245754.js";import{c as m,d as u,e as p,R as h,P as g,f as x,g as y,h as f,i as j,j as N}from"./vendor-icons-c7e63e01.js";import"./vendor-a9d0ef7a.js";import"./utils-dd3de9b4.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const E={},S=function(e,t,a){if(!t||0===t.length)return e();const n=document.getElementsByTagName("link");return Promise.all(t.map((e=>{if((e=function(e){return"/DietApp/"+e}(e))in E)return;E[e]=!0;const t=e.endsWith(".css"),s=t?'[rel="stylesheet"]':"";if(!!a)for(let a=n.length-1;a>=0;a--){const s=n[a];if(s.href===e&&(!t||"stylesheet"===s.rel))return}else if(document.querySelector(`link[href="${e}"]${s}`))return;const l=document.createElement("link");return l.rel=t?"stylesheet":"modulepreload",t||(l.as="script",l.crossOrigin=""),l.href=e,document.head.appendChild(l),t?new Promise(((t,a)=>{l.addEventListener("load",t),l.addEventListener("error",(()=>a(new Error(`Unable to preload CSS for ${e}`))))})):void 0}))).then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))},D=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.U))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),b=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.M))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),_=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.e))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),v=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.f))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),w=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.S))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),C=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.g))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),P=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.d))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),A=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.R))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),L=e.lazy((()=>S((()=>import("./components-fe245754.js").then((e=>e.W))),["assets/components-fe245754.js","assets/vendor-react-2952a862.js","assets/vendor-a9d0ef7a.js","assets/vendor-icons-c7e63e01.js","assets/utils-dd3de9b4.js"]))),O={Colazione:t.jsx(x,{className:"h-5 w-5"}),"Spuntino Matt.":t.jsx(y,{className:"h-5 w-5"}),Pranzo:t.jsx(f,{className:"h-5 w-5"}),Merenda:t.jsx(j,{className:"h-5 w-5"}),Cena:t.jsx(N,{className:"h-5 w-5"})};function I(){return["DOMENICA","LUNEDÃŒ","MARTEDÃŒ","MERCOLEDÃŒ","GIOVEDÃŒ","VENERDÃŒ","SABATO"][(new Date).getDay()]}const T=()=>{var a,n;const[d,x]=useLocalStorage("mealPlans",[]),[y,f]=useLocalStorage("currentPlanId",null),[j,N]=useLocalStorage("nutritionData",{}),[E,S]=useLocalStorage("userName",""),[T,R]=e.useState(!1),[z,k]=useLocalStorage("selectedDay",I());e.useEffect((()=>{y&&k(I())}),[y]);const[M,V]=e.useState(!1),[U,$]=e.useState(null),[B,F]=useLocalStorage("swappedDays",[]),[G,q]=e.useState(null),[W,H]=e.useState(!1);e.useState(!1);const[K,J]=e.useState(!1),[Q,X]=e.useState(null),[Y,Z]=e.useState(!1),[ee,te]=e.useState(null),[ae,ne]=e.useState(!1),[se,le]=e.useState(!1),[ie,oe]=e.useState(""),[re,ce]=e.useState(!1),de=d.find((e=>e.id===y)),me=(e,t="success",a=null)=>{X({message:e,type:t,action:a})},ue=(null==(a=null==de?void 0:de.plan)?void 0:a[z])?calculateDailyTotals(de.plan[z]):{calories:0,protein:0,carbs:0,fat:0};return t.jsxs("div",{className:"max-w-md mx-auto p-4 bg-gray-50 min-h-screen",children:[t.jsxs("div",{className:"sticky top-0 z-50 bg-gray-50 pb-4",children:[t.jsxs("div",{className:"flex items-center justify-start mb-3",children:[t.jsx("img",{src:"/DietApp/DietApp-logo.png",alt:"DietApp Logo",className:"h-16 w-auto mr-2"}),t.jsx("span",{className:"text-2xl font-bold text-gray-700",children:"DietApp"})]}),y&&t.jsx(s,{className:"mb-2",children:t.jsx(l,{className:"py-3 px-4",children:t.jsxs("div",{className:"text-center",children:[t.jsx("h2",{className:"text-lg font-medium text-gray-700",children:(()=>{const e=(new Date).getHours();return`${e>=5&&e<12?"Buongiorno":e>=12&&e<18?"Buon pomeriggio":"Buonasera"}, ${E||"Ospite"} ðŸ‘‹`})()}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:(new Date).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})})}),t.jsx("div",{onClick:()=>ce(!re),className:"cursor-pointer mb-4",children:t.jsxs("div",{className:"flex items-center justify-between bg-white rounded-lg p-3 shadow-sm",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700",children:y?null==(n=d.find((e=>e.id===y)))?void 0:n.name:"Seleziona o carica un piano"}),t.jsx(m,{className:"h-4 w-4 text-gray-400 transition-transform duration-200 "+(re?"rotate-180":"")})]})}),re&&t.jsx("div",{className:"mb-4",children:t.jsx(D,{currentUser:y,users:d.map((e=>({id:e.id,name:e.name}))),onUserChange:e=>{f(e),k(I()),ce(!1)},onPlanUpload:async e=>{const t=e.target.files[0];if(t)try{const e=await parseFile(t),a=`plan-${Date.now()}`,n=t.name.split(".")[0];x((t=>[...t,{id:a,name:n,plan:e,created:(new Date).toISOString()}])),f(a),R(!0)}catch(a){me(`Errore nel caricamento del file: ${a.message}`,"error")}},onNutritionUpload:async e=>{const t=e.target.files[0];if(t)try{const e=await parseNutritionData(t);N((t=>({...t,...e}))),alert("Informazioni nutrizionali caricate con successo!")}catch(a){alert(`Errore nel caricamento del file: ${a.message}`)}},onDeletePlan:e=>{const t=e===y,a=d.filter((t=>t.id!==e));t&&(a.length>0?f(a[0].id):f(null),F([])),x(a),me("Piano eliminato con successo","success")},onClearAll:()=>{x([]),f(null),F([]),me("Tutti i piani sono stati eliminati","success")},onAddManualPlan:()=>{J(!0)}})}),y&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx("button",{onClick:()=>{V(!M),$(null)},className:"p-2 rounded-lg transition-all duration-200 "+(M?"bg-yellow-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"),title:M?"Annulla Scambio":"Scambia Giorni",children:t.jsx(u,{className:"h-5 w-5"})}),t.jsx("div",{className:"flex space-x-2",children:B.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{if(0===B.length)return;const e=d.find((e=>e.id===y));if(!e)return;const t=B[B.length-1],a={...e},n={...a.plan[t.day1]};a.plan[t.day1]={...a.plan[t.day2]},a.plan[t.day2]=n,x((e=>e.map((e=>e.id===y?a:e)))),F((e=>e.slice(0,-1)))},className:"p-2 rounded-lg bg-gray-100 hover:bg-gray-200",title:"Annulla Ultimo Scambio",children:t.jsx(p,{className:"h-5 w-5 text-gray-600"})}),t.jsx("button",{onClick:()=>{if(0===B.length)return;const e=d.find((e=>e.id===y));if(!e)return;let t={...e};[...B].reverse().forEach((e=>{const a={...t.plan[e.day1]};t.plan[e.day1]={...t.plan[e.day2]},t.plan[e.day2]=a})),x((e=>e.map((e=>e.id===y?t:e)))),F([])},className:"p-2 rounded-lg bg-red-100 hover:bg-red-200",title:"Ripristina Tutti gli Scambi",children:t.jsx(h,{className:"h-5 w-5 text-red-600"})})]})})]}),t.jsx("div",{className:"grid grid-cols-7 gap-1 mb-4",children:["LUNEDÃŒ","MARTEDÃŒ","MERCOLEDÃŒ","GIOVEDÃŒ","VENERDÃŒ","SABATO","DOMENICA"].map((e=>{const a=B.find((t=>t.day1===e||t.day2===e)),n=a?{otherDay:a.day1===e?a.day2:a.day1,date:a.date}:null;return t.jsx(i,{day:e,isSelected:z===e,isSwapMode:M,isFirstDay:U===e,isSwapped:!!a,swapInfo:n,onClick:()=>M?(e=>{if(U){if(U!==e){const t=d.find((e=>e.id===y));if(!t)return;const a={...t},n={...a.plan[U]};a.plan[U]={...a.plan[e]},a.plan[e]=n,x((e=>e.map((e=>e.id===y?a:e)))),F((t=>[...t,{day1:U,day2:e,date:(new Date).toISOString()}])),$(null),V(!1)}}else $(e)})(e):k(e)},e)}))}),M&&t.jsx("div",{className:"mt-2 text-sm text-center text-gray-600 mb-4",children:U?"Ora seleziona il secondo giorno per completare lo scambio":"Seleziona il primo giorno da scambiare"})]})]}),t.jsxs(e.Suspense,{fallback:t.jsx("div",{className:"p-4 text-center",children:"Caricamento..."}),children:[T&&t.jsx(L,{onSaveName:e=>{S(e),R(!1)},onClose:()=>R(!1)}),G&&t.jsx(b,{meal:G.meal,items:G.items,nutritionData:j,onSave:e=>{const t={...de};t.plan[z][G.meal]=e,x((e=>e.map((e=>e.id===y?t:e)))),q(null)},onCancel:()=>q(null)}),(W||ae)&&t.jsx(_,{nutritionData:j,initialPlan:null==de?void 0:de.plan,isEditing:ae,onSave:e=>{if(ae)x((t=>t.map((t=>t.id===y?{...t,plan:e}:t)))),ne(!1),me("Piano aggiornato con successo","success");else{d.find((e=>e.id===y))&&(x((t=>t.map((t=>t.id===y?{...t,plan:e}:t)))),H(!1),me("Nuovo piano creato con successo","success"))}},onCancel:handleCancelPlanEdit})]}),K&&t.jsx(C,{onConfirm:e=>{oe(e),J(!1),le(!0)},onCancel:()=>J(!1)}),y&&(null==de?void 0:de.plan)&&t.jsx(w,{onSwipe:e=>{const t=Object.keys(de.plan),a=t.indexOf(z),n="left"===e?(a+1)%t.length:(a-1+t.length)%t.length;k(t[n])},children:t.jsxs("div",{className:"space-y-4 mt-4",children:[t.jsx(s,{className:"mb-6",children:t.jsxs(l,{className:"py-3 px-4",children:[t.jsx(o,{className:"text-sm font-medium",children:"Totali Giornalieri"}),t.jsx(r,{children:t.jsx(c,{nutrition:ue})})]})}),Object.entries(de.plan[z]||{}).map((([e,a])=>t.jsxs("div",{className:"relative",children:[t.jsx("button",{onClick:()=>q({meal:e,items:a}),className:"absolute top-2 right-2 p-2 text-gray-400 hover:text-gray-600 z-10",children:t.jsx(g,{className:"h-4 w-4"})}),t.jsx(v,{title:e,items:a,mealIcons:O,nutritionData:j})]},e)))]})}),Q&&t.jsx(P,{message:Q.message,type:Q.type,action:Q.action,onClose:()=>X(null)}),Y&&ee&&t.jsx(A,{currentName:ee.name,onConfirm:e=>{const t=e.toLowerCase().includes("piano")?e:`Piano Alimentare ${e}`;x((e=>e.map((e=>e.id===ee.id?{...e,name:t}:e)))),Z(!1),te(null),me("Piano rinominato con successo","success")},onCancel:()=>{Z(!1),te(null)}})]})},R=e.createContext(null),z=({children:a})=>{const[n,s]=e.useState(null),l=e.useCallback(((e,t="success",a=3e3)=>{s({message:e,type:t,duration:a})}),[]),i=e.useCallback((()=>{s(null)}),[]);return t.jsxs(R.Provider,{value:{showToast:l,hideToast:i},children:[a,n&&t.jsx(d,{message:n.message,type:n.type,duration:n.duration,onClose:i})]})};a.createRoot(document.getElementById("root")).render(t.jsx(n.StrictMode,{children:t.jsx(z,{children:t.jsx(T,{})})}));
